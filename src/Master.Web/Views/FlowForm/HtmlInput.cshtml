@using Master.Web.Components
@inherits Master.Web.Components.MasterRazorPage<TModel>
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@addTagHelper *, Master.Web.Core
@{
    Layout = "~/Views/Shared/_LayoutDialog.cshtml";
    ViewData["Title"] = "Html";
}
<script>
    var _formOption = {
        readonly: false,
    };
</script>

@Html.Raw(ViewBag.FormContent)

@section scripts{
    <script>
        


        function submit() {
            
            var formId = $.getUrlParam("data");
            var flowSchemeId = $.getUrlParam("flowSchemeId");
            var formData = {};

            if (typeof (getFormData) != "undefined") {
                try {
                    formData = getFormData();
                } catch (err) {
                    abp.message.error(err.message||err);
                    return false;
                }
                
            } else {
                abp.message.error(L("模板错误，必须实现getFormData方法"));
                return false;
            }

            abp.message.confirm(L("确认提交?"), function () {
                var dto = { flowSchemeId: flowSchemeId, flowFormId: formId, formData: JSON.stringify(formData) };
                func.runAsync(abp.services.app.flowInstance.createInstance(dto).done(function () {
                    top.layer.msg(L("提交成功"));
                    parent.layer.closeAll('iframe');
                    parent.config.reloadTable();
                    parent.config.refresh();
                }))
            })

            
        }

    </script>
}